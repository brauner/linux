This took a good week to get into a shape including 3 rewrites to
different data structures and testing.
